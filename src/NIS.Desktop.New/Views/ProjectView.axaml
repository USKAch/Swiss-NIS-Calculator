<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:ui="using:FluentAvalonia.UI.Controls"
             xmlns:vm="using:NIS.Desktop.New.ViewModels"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="600"
             x:Class="NIS.Desktop.New.Views.ProjectView"
             x:DataType="vm:ProjectViewModel">

    <Grid RowDefinitions="Auto,*,Auto">

        <!-- Header with project name -->
        <Border Grid.Row="0"
                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                BorderThickness="0,0,0,1"
                Padding="20,16">
            <Grid ColumnDefinitions="*,Auto">
                <StackPanel Grid.Column="0" Spacing="4">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBox Text="{Binding ProjectName}"
                                 FontSize="24" FontWeight="Bold"
                                 MinWidth="200"
                                 BorderThickness="0"
                                 Background="Transparent"/>
                        <TextBlock Text="{Binding DirtyIndicator}"
                                   FontSize="24" FontWeight="Bold"
                                   Foreground="{DynamicResource SystemFillColorCautionBrush}"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                    <TextBlock Text="{Binding Callsign}"
                               Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                    <Button Command="{Binding SaveCommand}" ToolTip.Tip="{Binding Loc[Project.Save]}">
                        <ui:SymbolIcon Symbol="Save"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content -->
        <ScrollViewer Grid.Row="1" Padding="20">
            <StackPanel Spacing="16">

                <!-- Station Info Card -->
                <ui:SettingsExpander Header="{Binding Loc[Project.StationInfo]}"
                                     Description="{Binding Address}"
                                     IconSource="ContactInfo">
                    <ui:SettingsExpander.Footer>
                        <Button Content="{Binding Loc[Project.StationInfo.Edit]}"/>
                    </ui:SettingsExpander.Footer>
                </ui:SettingsExpander>

                <!-- Configurations Section -->
                <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="16">
                    <StackPanel Spacing="12">
                        <Grid ColumnDefinitions="*,Auto">
                            <TextBlock Text="{Binding Loc[Project.Configurations]}"
                                       FontSize="18" FontWeight="SemiBold"/>
                            <Button Grid.Column="1"
                                    Command="{Binding AddConfigurationCommand}"
                                    Classes="accent">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <ui:SymbolIcon Symbol="Add"/>
                                    <TextBlock Text="{Binding Loc[Project.Configurations.Add]}"/>
                                </StackPanel>
                            </Button>
                        </Grid>

                        <!-- Empty state -->
                        <Border IsVisible="{Binding !HasConfigurations}"
                                Background="{DynamicResource LayerFillColorDefaultBrush}"
                                CornerRadius="4"
                                Padding="20">
                            <StackPanel HorizontalAlignment="Center" Spacing="8">
                                <ui:SymbolIcon Symbol="RadioButton" FontSize="32"/>
                                <TextBlock Text="{Binding Loc[Project.Configurations.Empty]}"
                                           Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                            </StackPanel>
                        </Border>

                        <!-- Configuration table -->
                        <Grid IsVisible="{Binding HasConfigurations}" RowDefinitions="Auto,Auto,*">
                            <!-- Column Headers -->
                            <Grid Grid.Row="0" ColumnDefinitions="30,180,150,50,1,100,60,1,100,50,1,70" Margin="8,0,8,8">
                                <TextBlock Grid.Column="0" Text="{Binding Loc[Project.Configurations.Header.Number]}" FontWeight="SemiBold" Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                                <TextBlock Grid.Column="1" Text="{Binding Loc[Project.Configurations.Header.Antenna]}" FontWeight="SemiBold" Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                                <TextBlock Grid.Column="2" Text="{Binding Loc[Project.Configurations.Header.Bands]}" FontWeight="SemiBold" Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                                <TextBlock Grid.Column="3" Text="{Binding Loc[Project.Configurations.Header.Height]}" FontWeight="SemiBold" Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                                <Border Grid.Column="4" Width="1" Background="{DynamicResource DividerStrokeColorDefaultBrush}" Margin="8,0"/>
                                <TextBlock Grid.Column="5" Text="{Binding Loc[Project.Configurations.Header.Cable]}" FontWeight="SemiBold" Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                                <TextBlock Grid.Column="6" Text="{Binding Loc[Project.Configurations.Header.Power]}" FontWeight="SemiBold" Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                                <Border Grid.Column="7" Width="1" Background="{DynamicResource DividerStrokeColorDefaultBrush}" Margin="8,0"/>
                                <TextBlock Grid.Column="8" Text="{Binding Loc[Project.Configurations.Header.OKA]}" FontWeight="SemiBold" Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                                <TextBlock Grid.Column="9" Text="{Binding Loc[Project.Configurations.Header.Distance]}" FontWeight="SemiBold" Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                                <Border Grid.Column="10" Width="1" Background="{DynamicResource DividerStrokeColorDefaultBrush}" Margin="8,0"/>
                                <TextBlock Grid.Column="11" Text="" FontWeight="SemiBold" Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                            </Grid>

                            <!-- Divider -->
                            <Border Grid.Row="1" Height="1" Background="{DynamicResource DividerStrokeColorDefaultBrush}" Margin="0,0,0,4"/>

                            <!-- Data Rows -->
                            <ItemsControl Grid.Row="2" ItemsSource="{Binding ConfigurationItems}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{DynamicResource LayerFillColorDefaultBrush}"
                                                CornerRadius="4"
                                                Padding="8,6"
                                                Margin="0,2">
                                            <Grid ColumnDefinitions="30,180,150,50,1,100,60,1,100,50,1,70">
                                                <TextBlock Grid.Column="0" Text="{Binding NumberDisplay}" FontWeight="Bold" VerticalAlignment="Center"/>
                                                <TextBlock Grid.Column="1" Text="{Binding AntennaDisplay}" FontWeight="SemiBold" TextTrimming="CharacterEllipsis" VerticalAlignment="Center"/>
                                                <TextBlock Grid.Column="2" Text="{Binding BandsDisplay}" FontSize="11" Foreground="{DynamicResource TextFillColorSecondaryBrush}" TextTrimming="CharacterEllipsis" VerticalAlignment="Center"/>
                                                <TextBlock Grid.Column="3" Text="{Binding HeightDisplay}" Foreground="{DynamicResource TextFillColorSecondaryBrush}" VerticalAlignment="Center"/>
                                                <Border Grid.Column="4" Width="1" Background="{DynamicResource DividerStrokeColorDefaultBrush}" Margin="8,2"/>
                                                <TextBlock Grid.Column="5" Text="{Binding CableDisplay}" Foreground="{DynamicResource TextFillColorSecondaryBrush}" TextTrimming="CharacterEllipsis" VerticalAlignment="Center"/>
                                                <TextBlock Grid.Column="6" Text="{Binding PowerDisplay}" Foreground="{DynamicResource TextFillColorSecondaryBrush}" VerticalAlignment="Center"/>
                                                <Border Grid.Column="7" Width="1" Background="{DynamicResource DividerStrokeColorDefaultBrush}" Margin="8,2"/>
                                                <TextBlock Grid.Column="8" Text="{Binding OkaNameDisplay}" Foreground="{DynamicResource AccentTextFillColorPrimaryBrush}" TextTrimming="CharacterEllipsis" VerticalAlignment="Center"/>
                                                <TextBlock Grid.Column="9" Text="{Binding OkaDistanceDisplay}" Foreground="{DynamicResource TextFillColorSecondaryBrush}" VerticalAlignment="Center"/>
                                                <Border Grid.Column="10" Width="1" Background="{DynamicResource DividerStrokeColorDefaultBrush}" Margin="8,2"/>
                                                <StackPanel Grid.Column="11" Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                                                    <Button Command="{Binding $parent[ItemsControl].((vm:ProjectViewModel)DataContext).EditConfigurationCommand}"
                                                            CommandParameter="{Binding}"
                                                            Padding="6,4"
                                                            ToolTip.Tip="{Binding $parent[ItemsControl].((vm:ProjectViewModel)DataContext).Loc[Common.Edit]}">
                                                        <ui:SymbolIcon Symbol="Edit" FontSize="12"/>
                                                    </Button>
                                                    <Button Command="{Binding $parent[ItemsControl].((vm:ProjectViewModel)DataContext).DeleteConfigurationCommand}"
                                                            CommandParameter="{Binding}"
                                                            Padding="6,4"
                                                            ToolTip.Tip="{Binding $parent[ItemsControl].((vm:ProjectViewModel)DataContext).Loc[Common.Delete]}">
                                                        <ui:SymbolIcon Symbol="Delete" FontSize="12"/>
                                                    </Button>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Action Buttons -->
                <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="16">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="16">
                        <Button Command="{Binding CalculateCommand}"
                                IsEnabled="{Binding CanCalculate}"
                                Classes="accent"
                                Padding="24,12">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <ui:SymbolIcon Symbol="Calculator"/>
                                <TextBlock Text="{Binding Loc[Project.Calculate]}"/>
                            </StackPanel>
                        </Button>
                        <Button Command="{Binding ExportReportCommand}"
                                IsEnabled="{Binding HasConfigurations}"
                                Padding="24,12">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <ui:SymbolIcon Symbol="Save"/>
                                <TextBlock Text="{Binding Loc[Project.Export]}"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Border>

            </StackPanel>
        </ScrollViewer>

        <!-- Status Bar -->
        <Border Grid.Row="2"
                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                BorderThickness="0,1,0,0"
                Padding="16,8">
            <TextBlock Text="{Binding StatusMessage}"
                       Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
        </Border>

    </Grid>
</UserControl>
