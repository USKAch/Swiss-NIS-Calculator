<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:NIS.Desktop.ViewModels"
             xmlns:loc="using:NIS.Desktop.Localization"
             xmlns:conv="using:NIS.Desktop.Converters"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="600"
             x:Class="NIS.Desktop.Views.ResultsView"
             x:DataType="vm:ResultsViewModel">

    <UserControl.Resources>
        <conv:ComplianceColorConverter x:Key="ComplianceColorConverter"/>
        <conv:ComplianceTextConverter x:Key="ComplianceTextConverter"/>
    </UserControl.Resources>

    <Design.DataContext>
        <vm:ResultsViewModel/>
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*,Auto">
        <!-- Header -->
        <Border Grid.Row="0" Background="#2196F3" Padding="20,15">
            <Grid ColumnDefinitions="*,Auto">
                <StackPanel>
                    <TextBlock Text="{Binding CalculationResults, Source={x:Static loc:Strings.Instance}}" FontSize="20" FontWeight="Bold" Foreground="White"/>
                    <TextBlock Text="{Binding ComplianceSummary}" FontSize="12" Foreground="#BBDEFB" Margin="0,3,0,0"/>
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                    <Button Content="{Binding ExportMarkdown, Source={x:Static loc:Strings.Instance}}" Command="{Binding ExportMarkdownCommand}"
                            Background="#4CAF50" Foreground="White" Padding="15,8"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Results List -->
        <ScrollViewer Grid.Row="1" Padding="20" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding Results}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}" CornerRadius="8" Padding="15" Margin="0,0,0,15">
                            <StackPanel Spacing="10">
                                <!-- Configuration Header -->
                                <Grid ColumnDefinitions="*,Auto">
                                    <StackPanel>
                                        <StackPanel Orientation="Horizontal" Spacing="10">
                                            <TextBlock Text="{Binding ConfigurationName}" FontSize="18" FontWeight="Bold"/>
                                            <Border CornerRadius="4" Padding="8,3"
                                                    Background="{Binding IsCompliant, Converter={StaticResource ComplianceColorConverter}}">
                                                <TextBlock Text="{Binding IsCompliant, Converter={StaticResource ComplianceTextConverter}}"
                                                           Foreground="White" FontWeight="SemiBold" FontSize="11"/>
                                            </Border>
                                        </StackPanel>
                                        <TextBlock Opacity="0.6" FontSize="12" Margin="0,3,0,0">
                                            <TextBlock.Text>
                                                <MultiBinding StringFormat="{}{0} | {1}W | {2}">
                                                    <Binding Path="AntennaName"/>
                                                    <Binding Path="PowerWatts"/>
                                                    <Binding Path="Modulation"/>
                                                </MultiBinding>
                                            </TextBlock.Text>
                                        </TextBlock>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" HorizontalAlignment="Right">
                                        <TextBlock Text="{Binding OkaName}" FontWeight="SemiBold"/>
                                        <TextBlock Opacity="0.6" FontSize="12">
                                            <TextBlock.Text>
                                                <MultiBinding StringFormat="{}Distance: {0:F1}m | Damping: {1:F0}dB">
                                                    <Binding Path="OkaDistance"/>
                                                    <Binding Path="BuildingDampingDb"/>
                                                </MultiBinding>
                                            </TextBlock.Text>
                                        </TextBlock>
                                    </StackPanel>
                                </Grid>

                                <!-- Band Results Table -->
                                <Border Background="White" CornerRadius="4" Padding="10">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>

                                        <!-- Table Header -->
                                        <Grid ColumnDefinitions="80,80,80,100,80,80,80" Background="#E0E0E0" Margin="-10,-10,-10,0">
                                            <TextBlock Text="{Binding FreqHeader, Source={x:Static loc:Strings.Instance}}" FontWeight="SemiBold" Padding="10,8" HorizontalAlignment="Center"/>
                                            <TextBlock Grid.Column="1" Text="{Binding GainHeader, Source={x:Static loc:Strings.Instance}}" FontWeight="SemiBold" Padding="10,8" HorizontalAlignment="Center"/>
                                            <TextBlock Grid.Column="2" Text="{Binding PmHeader, Source={x:Static loc:Strings.Instance}}" FontWeight="SemiBold" Padding="10,8" HorizontalAlignment="Center"/>
                                            <TextBlock Grid.Column="3" Text="{Binding FieldHeader, Source={x:Static loc:Strings.Instance}}" FontWeight="SemiBold" Padding="10,8" HorizontalAlignment="Center"/>
                                            <TextBlock Grid.Column="4" Text="{Binding Limit, Source={x:Static loc:Strings.Instance}}" FontWeight="SemiBold" Padding="10,8" HorizontalAlignment="Center"/>
                                            <TextBlock Grid.Column="5" Text="{Binding SafetyHeader, Source={x:Static loc:Strings.Instance}}" FontWeight="SemiBold" Padding="10,8" HorizontalAlignment="Center"/>
                                            <TextBlock Grid.Column="6" Text="{Binding StatusHeader, Source={x:Static loc:Strings.Instance}}" FontWeight="SemiBold" Padding="10,8" HorizontalAlignment="Center"/>
                                        </Grid>

                                        <!-- Table Rows -->
                                        <ItemsControl Grid.Row="1" ItemsSource="{Binding BandResults}" Margin="0,5,0,0">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Grid ColumnDefinitions="80,80,80,100,80,80,80" Margin="0,3">
                                                        <TextBlock HorizontalAlignment="Center">
                                                            <TextBlock.Text>
                                                                <Binding Path="FrequencyMHz" StringFormat="{}{0:F0} MHz"/>
                                                            </TextBlock.Text>
                                                        </TextBlock>
                                                        <TextBlock Grid.Column="1" HorizontalAlignment="Center">
                                                            <TextBlock.Text>
                                                                <Binding Path="GainDbi" StringFormat="{}{0:F1} dBi"/>
                                                            </TextBlock.Text>
                                                        </TextBlock>
                                                        <TextBlock Grid.Column="2" HorizontalAlignment="Center">
                                                            <TextBlock.Text>
                                                                <Binding Path="MeanPowerW" StringFormat="{}{0:F1} W"/>
                                                            </TextBlock.Text>
                                                        </TextBlock>
                                                        <TextBlock Grid.Column="3" HorizontalAlignment="Center" FontWeight="SemiBold">
                                                            <TextBlock.Text>
                                                                <Binding Path="FieldStrength" StringFormat="{}{0:F2}"/>
                                                            </TextBlock.Text>
                                                        </TextBlock>
                                                        <TextBlock Grid.Column="4" HorizontalAlignment="Center">
                                                            <TextBlock.Text>
                                                                <Binding Path="Limit" StringFormat="{}{0:F1}"/>
                                                            </TextBlock.Text>
                                                        </TextBlock>
                                                        <TextBlock Grid.Column="5" HorizontalAlignment="Center">
                                                            <TextBlock.Text>
                                                                <Binding Path="SafetyDistance" StringFormat="{}{0:F2} m"/>
                                                            </TextBlock.Text>
                                                        </TextBlock>
                                                        <TextBlock Grid.Column="6" HorizontalAlignment="Center"
                                                                   Text="{Binding IsCompliant, Converter={StaticResource ComplianceTextConverter}}"
                                                                   Foreground="{Binding IsCompliant, Converter={StaticResource ComplianceColorConverter}}"
                                                                   FontWeight="SemiBold"/>
                                                    </Grid>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </Grid>
                                </Border>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Footer -->
        <Border Grid.Row="2" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}" Padding="20,15">
            <Grid ColumnDefinitions="*,Auto">
                <TextBlock Text="{Binding StatusMessage}" VerticalAlignment="Center"/>
                <Button Grid.Column="1" Content="{Binding Close, Source={x:Static loc:Strings.Instance}}" Command="{Binding CloseCommand}" Padding="20,10"/>
            </Grid>
        </Border>
    </Grid>
</UserControl>
