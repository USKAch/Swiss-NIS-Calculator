<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:NIS.Desktop.ViewModels"
             xmlns:loc="using:NIS.Desktop.Localization"
             xmlns:conv="using:NIS.Desktop.Converters"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="600"
             x:Class="NIS.Desktop.Views.ResultsView"
             x:DataType="vm:ResultsViewModel">

    <UserControl.Resources>
        <conv:ComplianceColorConverter x:Key="ComplianceColorConverter"/>
        <conv:ComplianceTextConverter x:Key="ComplianceTextConverter"/>
    </UserControl.Resources>

    <Design.DataContext>
        <vm:ResultsViewModel/>
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*,Auto">
        <!-- Header -->
        <Border Grid.Row="0"
                Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                BorderBrush="{DynamicResource HeaderPrimaryBrush}"
                BorderThickness="0,0,0,2"
                Padding="20,15">
            <Grid ColumnDefinitions="*,Auto">
                <StackPanel>
                    <TextBlock Text="{Binding CalculationResults, Source={x:Static loc:Strings.Instance}}" FontSize="20" FontWeight="Bold" Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                    <TextBlock Text="{Binding ComplianceSummary}" FontSize="12" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Margin="0,3,0,0"/>
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                    <Button Content="{Binding ExportMarkdown, Source={x:Static loc:Strings.Instance}}" Command="{Binding ExportMarkdownCommand}"
                            Padding="15,8"/>
                    <Button Content="{Binding ExportPdf, Source={x:Static loc:Strings.Instance}}" Command="{Binding ExportPdfCommand}"
                            Background="{DynamicResource PrimaryButtonBrush}" Foreground="{DynamicResource HeaderForegroundBrush}" Padding="15,8"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Results List -->
        <ScrollViewer Grid.Row="1" Padding="20" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding Results}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}" CornerRadius="8" Padding="15" Margin="0,0,0,15">
                            <StackPanel Spacing="12">
                                <!-- Configuration Title -->
                                <StackPanel Orientation="Horizontal" Spacing="12">
                                    <TextBlock Text="{Binding ConfigurationName}" FontSize="18" FontWeight="Bold"/>
                                    <Border CornerRadius="4" Padding="10,4" VerticalAlignment="Center"
                                            Background="{Binding IsCompliant, Converter={StaticResource ComplianceColorConverter}}">
                                        <TextBlock Text="{Binding IsCompliant, Converter={StaticResource ComplianceTextConverter}}"
                                                   Foreground="{DynamicResource HeaderForegroundBrush}" FontWeight="SemiBold" FontSize="12"/>
                                    </Border>
                                </StackPanel>

                                <!-- Configuration Details - single line -->
                                <TextBlock Text="{Binding ConfigDescription}" FontSize="14" Opacity="0.8" TextWrapping="Wrap"/>

                                <!-- Band Results Table -->
                                <Border Background="{DynamicResource CardBackgroundFillColorDefault}" CornerRadius="4" Padding="10">
                                    <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>

                                        <!-- Table Header (two lines: label + unit) -->
                                        <Grid ColumnDefinitions="45,50,55,55,50,70,55,50,55,55,60,60,55" Background="{DynamicResource SystemControlBackgroundAltMediumLowBrush}" Margin="-10,-10,-10,0">
                                            <StackPanel HorizontalAlignment="Center" Margin="0,6,0,4">
                                                <TextBlock Text="f" FontWeight="SemiBold" FontSize="13" Foreground="{DynamicResource TextFillColorSecondaryBrush}" HorizontalAlignment="Center"/>
                                                <TextBlock Text="MHz" FontSize="11" Foreground="{DynamicResource TextFillColorTertiaryBrush}" HorizontalAlignment="Center"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="1" HorizontalAlignment="Center" Margin="0,6,0,4">
                                                <TextBlock Text="{Binding PmittelLbl, Source={x:Static loc:Strings.Instance}}" FontWeight="SemiBold" FontSize="13" Foreground="{DynamicResource TextFillColorSecondaryBrush}" HorizontalAlignment="Center"/>
                                                <TextBlock Text="W" FontSize="11" Foreground="{DynamicResource TextFillColorTertiaryBrush}" HorizontalAlignment="Center"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="2" HorizontalAlignment="Center" Margin="0,6,0,4">
                                                <TextBlock Text="{Binding CableLbl, Source={x:Static loc:Strings.Instance}}" FontWeight="SemiBold" FontSize="13" Foreground="{DynamicResource TextFillColorSecondaryBrush}" HorizontalAlignment="Center"/>
                                                <TextBlock Text="dB" FontSize="11" Foreground="{DynamicResource TextFillColorTertiaryBrush}" HorizontalAlignment="Center"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="3" HorizontalAlignment="Center" Margin="0,6,0,4">
                                                <TextBlock Text="{Binding GainLbl, Source={x:Static loc:Strings.Instance}}" FontWeight="SemiBold" FontSize="13" Foreground="{DynamicResource TextFillColorSecondaryBrush}" HorizontalAlignment="Center"/>
                                                <TextBlock Text="dBi" FontSize="11" Foreground="{DynamicResource TextFillColorTertiaryBrush}" HorizontalAlignment="Center"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="4" HorizontalAlignment="Center" Margin="0,6,0,4">
                                                <TextBlock Text="{Binding VertLbl, Source={x:Static loc:Strings.Instance}}" FontWeight="SemiBold" FontSize="13" Foreground="{DynamicResource TextFillColorSecondaryBrush}" HorizontalAlignment="Center"/>
                                                <TextBlock Text="dB" FontSize="11" Foreground="{DynamicResource TextFillColorTertiaryBrush}" HorizontalAlignment="Center"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="5" HorizontalAlignment="Center" Margin="0,6,0,4">
                                                <TextBlock Text="{Binding TotGainLbl, Source={x:Static loc:Strings.Instance}}" FontWeight="SemiBold" FontSize="13" Foreground="{DynamicResource TextFillColorSecondaryBrush}" HorizontalAlignment="Center"/>
                                                <TextBlock Text="dB" FontSize="11" Foreground="{DynamicResource TextFillColorTertiaryBrush}" HorizontalAlignment="Center"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="6" HorizontalAlignment="Center" Margin="0,6,0,4">
                                                <TextBlock Text="{Binding EirpLbl, Source={x:Static loc:Strings.Instance}}" FontWeight="SemiBold" FontSize="13" Foreground="{DynamicResource TextFillColorSecondaryBrush}" HorizontalAlignment="Center"/>
                                                <TextBlock Text="W" FontSize="11" Foreground="{DynamicResource TextFillColorTertiaryBrush}" HorizontalAlignment="Center"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="7" HorizontalAlignment="Center" Margin="0,6,0,4">
                                                <TextBlock Text="{Binding BldLbl, Source={x:Static loc:Strings.Instance}}" FontWeight="SemiBold" FontSize="13" Foreground="{DynamicResource TextFillColorSecondaryBrush}" HorizontalAlignment="Center"/>
                                                <TextBlock Text="dB" FontSize="11" Foreground="{DynamicResource TextFillColorTertiaryBrush}" HorizontalAlignment="Center"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="8" HorizontalAlignment="Center" Margin="0,6,0,4">
                                                <TextBlock Text="E'" FontWeight="SemiBold" FontSize="13" Foreground="{DynamicResource TextFillColorSecondaryBrush}" HorizontalAlignment="Center"/>
                                                <TextBlock Text="V/m" FontSize="11" Foreground="{DynamicResource TextFillColorTertiaryBrush}" HorizontalAlignment="Center"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="9" HorizontalAlignment="Center" Margin="0,6,0,4">
                                                <TextBlock Text="{Binding LimitLbl, Source={x:Static loc:Strings.Instance}}" FontWeight="SemiBold" FontSize="13" Foreground="{DynamicResource TextFillColorSecondaryBrush}" HorizontalAlignment="Center"/>
                                                <TextBlock Text="V/m" FontSize="11" Foreground="{DynamicResource TextFillColorTertiaryBrush}" HorizontalAlignment="Center"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="10" HorizontalAlignment="Center" Margin="0,6,0,4">
                                                <TextBlock Text="{Binding SafeDistLbl, Source={x:Static loc:Strings.Instance}}" FontWeight="SemiBold" FontSize="13" Foreground="{DynamicResource TextFillColorSecondaryBrush}" HorizontalAlignment="Center"/>
                                                <TextBlock Text="m" FontSize="11" Foreground="{DynamicResource TextFillColorTertiaryBrush}" HorizontalAlignment="Center"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="11" HorizontalAlignment="Center" Margin="0,6,0,4">
                                                <TextBlock Text="{Binding OkaDistLbl, Source={x:Static loc:Strings.Instance}}" FontWeight="SemiBold" FontSize="13" Foreground="{DynamicResource TextFillColorSecondaryBrush}" HorizontalAlignment="Center"/>
                                                <TextBlock Text="m" FontSize="11" Foreground="{DynamicResource TextFillColorTertiaryBrush}" HorizontalAlignment="Center"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="12" HorizontalAlignment="Center" Margin="0,6,0,4">
                                                <TextBlock Text="{Binding StatusHeader, Source={x:Static loc:Strings.Instance}}" FontWeight="SemiBold" FontSize="13" Foreground="{DynamicResource TextFillColorSecondaryBrush}" HorizontalAlignment="Center"/>
                                                <TextBlock Text=" " FontSize="11" HorizontalAlignment="Center"/>
                                            </StackPanel>
                                        </Grid>

                                        <!-- Table Rows -->
                                        <ItemsControl Grid.Row="1" ItemsSource="{Binding BandResults}" Margin="0,8,0,0">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Padding="0,4" Margin="0,1">
                                                        <Grid ColumnDefinitions="45,50,55,55,50,70,55,50,55,55,60,60,55" Margin="-10,0,0,0">
                                                            <TextBlock Text="{Binding FrequencyMHz, StringFormat='{}{0:F0}'}" FontSize="13" HorizontalAlignment="Center"/>
                                                            <TextBlock Grid.Column="1" Text="{Binding MeanPowerW, StringFormat='{}{0:F1}'}" FontSize="13" HorizontalAlignment="Center"/>
                                                            <TextBlock Grid.Column="2" Text="{Binding TotalLossDb, StringFormat='{}{0:F1}'}" FontSize="13" HorizontalAlignment="Center"/>
                                                            <TextBlock Grid.Column="3" Text="{Binding GainDbi, StringFormat='{}{0:F1}'}" FontSize="13" HorizontalAlignment="Center"/>
                                                            <TextBlock Grid.Column="4" Text="{Binding VerticalAttenuation, StringFormat='{}{0:F1}'}" FontSize="13" HorizontalAlignment="Center"/>
                                                            <TextBlock Grid.Column="5" Text="{Binding TotalGainDbi, StringFormat='{}{0:F1}'}" FontSize="13" HorizontalAlignment="Center"/>
                                                            <TextBlock Grid.Column="6" Text="{Binding Eirp, StringFormat='{}{0:F1}'}" FontSize="13" HorizontalAlignment="Center"/>
                                                            <TextBlock Grid.Column="7" Text="{Binding BuildingDampingDb, StringFormat='{}{0:F1}'}" FontSize="13" HorizontalAlignment="Center"/>
                                                            <TextBlock Grid.Column="8" Text="{Binding FieldStrength, StringFormat='{}{0:F2}'}" FontSize="13" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                                                            <TextBlock Grid.Column="9" Text="{Binding Limit, StringFormat='{}{0:F1}'}" FontSize="13" HorizontalAlignment="Center"/>
                                                            <TextBlock Grid.Column="10" Text="{Binding SafetyDistance, StringFormat='{}{0:F1}'}" FontSize="13" HorizontalAlignment="Center"/>
                                                            <TextBlock Grid.Column="11" Text="{Binding OkaDistance, StringFormat='{}{0:F1}'}" FontSize="13" HorizontalAlignment="Center"/>
                                                            <TextBlock Grid.Column="12" FontSize="13" HorizontalAlignment="Center"
                                                                       Text="{Binding IsCompliant, Converter={StaticResource ComplianceTextConverter}}"
                                                                       Foreground="{Binding IsCompliant, Converter={StaticResource ComplianceColorConverter}}"
                                                                       FontWeight="SemiBold"/>
                                                        </Grid>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </Grid>
                                    </ScrollViewer>
                                </Border>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Footer -->
        <Border Grid.Row="2" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}" Padding="20,15">
            <Grid ColumnDefinitions="*,Auto">
                <TextBlock Text="{Binding StatusMessage}" VerticalAlignment="Center"/>
                <Button Grid.Column="1" Content="{Binding Close, Source={x:Static loc:Strings.Instance}}" Command="{Binding CloseCommand}" Padding="20,10"/>
            </Grid>
        </Border>
    </Grid>
</UserControl>

