<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:NIS.Desktop.ViewModels"
             xmlns:loc="using:NIS.Desktop.Localization"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="780" d:DesignHeight="900"
             x:Class="NIS.Desktop.Views.ConfigurationEditorView"
             x:DataType="vm:ConfigurationEditorViewModel">

    <Design.DataContext>
        <vm:ConfigurationEditorViewModel/>
    </Design.DataContext>

    <Grid RowDefinitions="*,Auto">
        <!-- Main Content -->
        <ScrollViewer Grid.Row="0" Padding="20" VerticalScrollBarVisibility="Visible" HorizontalScrollBarVisibility="Disabled">
            <StackPanel Spacing="20" Margin="0,0,0,20">

                <!-- Top Row: Antenna | Cable | OKA -->
                <Border Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}" CornerRadius="8" Padding="15">
                    <Grid ColumnDefinitions="1.3*,Auto,1.2*,Auto,*">
                        <!-- Antenna Section -->
                        <StackPanel Grid.Column="0" Spacing="6">
                            <TextBlock Text="{Binding Antenna, Source={x:Static loc:Strings.Instance}}" FontWeight="Bold" FontSize="16"/>

                            <!-- Antenna Selector -->
                            <StackPanel Spacing="8">
                                <ComboBox ItemsSource="{Binding Antennas}"
                                          SelectedItem="{Binding SelectedAntenna}" HorizontalAlignment="Stretch"
                                          IsTextSearchEnabled="True"
                                          PlaceholderText="{Binding SelectAntenna, Source={x:Static loc:Strings.Instance}}">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding DisplayName}"/>
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                                <StackPanel Orientation="Horizontal" Spacing="5">
                                    <!-- Edit button (green) for user-created items -->
                                    <Button Command="{Binding EditAntennaCommand}"
                                            IsEnabled="{Binding SelectedAntenna, Converter={x:Static ObjectConverters.IsNotNull}}"
                                            IsVisible="{Binding SelectedAntenna.IsUserData}"
                                            Background="{DynamicResource SuccessButtonBrush}" Foreground="{DynamicResource HeaderForegroundBrush}"
                                            Content="{Binding Edit, Source={x:Static loc:Strings.Instance}}" Padding="8,4"/>
                                    <!-- View button (default) for supplied items -->
                                    <Button Command="{Binding EditAntennaCommand}"
                                            IsEnabled="{Binding SelectedAntenna, Converter={x:Static ObjectConverters.IsNotNull}}"
                                            IsVisible="{Binding !SelectedAntenna.IsUserData}"
                                            Content="{Binding View, Source={x:Static loc:Strings.Instance}}" Padding="8,4"/>
                                    <Button Content="{Binding New, Source={x:Static loc:Strings.Instance}}" Command="{Binding AddAntennaCommand}"
                                            Background="{DynamicResource SuccessButtonBrush}" Foreground="{DynamicResource HeaderForegroundBrush}" Padding="8,4"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Antenna Bands Display -->
                            <Border Background="{DynamicResource CardBackgroundFillColorDefault}" CornerRadius="4" Padding="8"
                                    IsVisible="{Binding SelectedAntenna, Converter={x:Static ObjectConverters.IsNotNull}}">
                                <StackPanel Spacing="6">
                                    <TextBlock Text="{Binding FrequencyBands, Source={x:Static loc:Strings.Instance}}" FontWeight="SemiBold" FontSize="12"/>
                                    <ItemsControl ItemsSource="{Binding SelectedAntenna.Bands}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="{DynamicResource PanelBackgroundBrush}" CornerRadius="3" Padding="4,1" Margin="0,0">
                                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                                        <TextBlock Text="{Binding FrequencyMHz, StringFormat='{}{0} MHz'}" FontWeight="SemiBold" FontSize="11" Width="55"/>
                                                        <TextBlock Text="{Binding GainDbi, StringFormat='{}{0:F2} dBi'}" FontSize="11" Opacity="0.7"/>
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Border>

                            <!-- Height -->
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="{Binding Height, Source={x:Static loc:Strings.Instance}}" VerticalAlignment="Center" FontWeight="SemiBold"/>
                                <NumericUpDown Value="{Binding HeightMeters}" ShowButtonSpinner="False"
                                               Minimum="0" Maximum="100" Increment="0.5" Width="80"/>
                                <TextBlock Text="m" VerticalAlignment="Center"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Vertical Separator -->
                        <Border Grid.Column="1" Width="1" Background="{DynamicResource SystemControlForegroundBaseMediumBrush}" Margin="15,0" Opacity="0.3"/>

                        <!-- Cable Section -->
                        <StackPanel Grid.Column="2" Spacing="6">
                            <TextBlock Text="{Binding FeedLine, Source={x:Static loc:Strings.Instance}}" FontWeight="Bold" FontSize="16"/>

                            <!-- Cable Selector -->
                            <StackPanel Spacing="8">
                                <ComboBox ItemsSource="{Binding Cables}"
                                          SelectedItem="{Binding SelectedCable}" HorizontalAlignment="Stretch"
                                          IsTextSearchEnabled="True"
                                          PlaceholderText="{Binding SelectCable, Source={x:Static loc:Strings.Instance}}">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Name}"/>
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                                <StackPanel Orientation="Horizontal" Spacing="5">
                                    <!-- Edit button (green) for user-created items -->
                                    <Button Command="{Binding EditCableCommand}"
                                            IsEnabled="{Binding SelectedCable, Converter={x:Static ObjectConverters.IsNotNull}}"
                                            IsVisible="{Binding SelectedCable.IsUserData}"
                                            Background="{DynamicResource SuccessButtonBrush}" Foreground="{DynamicResource HeaderForegroundBrush}"
                                            Content="{Binding Edit, Source={x:Static loc:Strings.Instance}}" Padding="8,4"/>
                                    <!-- View button (default) for supplied items -->
                                    <Button Command="{Binding EditCableCommand}"
                                            IsEnabled="{Binding SelectedCable, Converter={x:Static ObjectConverters.IsNotNull}}"
                                            IsVisible="{Binding !SelectedCable.IsUserData}"
                                            Content="{Binding View, Source={x:Static loc:Strings.Instance}}" Padding="8,4"/>
                                    <Button Content="{Binding New, Source={x:Static loc:Strings.Instance}}" Command="{Binding AddCableCommand}"
                                            Background="{DynamicResource SuccessButtonBrush}" Foreground="{DynamicResource HeaderForegroundBrush}" Padding="8,4"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Cable Length -->
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="{Binding CableLength, Source={x:Static loc:Strings.Instance}}" VerticalAlignment="Center" FontWeight="SemiBold"/>
                                <NumericUpDown Value="{Binding CableLengthMeters}" ShowButtonSpinner="False"
                                               Minimum="0" Maximum="500" Increment="1" Width="80"/>
                                <TextBlock Text="m" VerticalAlignment="Center"/>
                            </StackPanel>

                            <!-- Additional Loss -->
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="{Binding AdditionalLoss, Source={x:Static loc:Strings.Instance}}" VerticalAlignment="Center" FontWeight="SemiBold"/>
                                <NumericUpDown Value="{Binding AdditionalLossDb}" ShowButtonSpinner="False"
                                               Minimum="0" Maximum="20" Increment="0.5" Width="80"/>
                                <TextBlock Text="dB" VerticalAlignment="Center"/>
                            </StackPanel>

                            <!-- Loss Description -->
                            <TextBox Text="{Binding AdditionalLossDescription}"
                                     Watermark="{Binding AdditionalLossExample, Source={x:Static loc:Strings.Instance}}"/>
                        </StackPanel>

                        <!-- Vertical Separator -->
                        <Border Grid.Column="3" Width="1" Background="{DynamicResource SystemControlForegroundBaseMediumBrush}" Margin="15,0" Opacity="0.3"/>

                        <!-- OKA Section -->
                        <StackPanel Grid.Column="4" Spacing="6">
                            <TextBlock Text="{Binding EvaluationPoint, Source={x:Static loc:Strings.Instance}}" FontWeight="Bold" FontSize="16"/>

                            <!-- OKA Selector -->
                            <StackPanel Spacing="8">
                                <ComboBox ItemsSource="{Binding Okas}"
                                          SelectedItem="{Binding SelectedOka}" HorizontalAlignment="Stretch"
                                          IsTextSearchEnabled="True"
                                          PlaceholderText="{Binding SelectOka, Source={x:Static loc:Strings.Instance}}">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding DisplayName}"/>
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                                <StackPanel Orientation="Horizontal" Spacing="5">
                                    <!-- Edit button (green) for user-created items -->
                                    <Button Command="{Binding EditOkaCommand}"
                                            IsEnabled="{Binding SelectedOka, Converter={x:Static ObjectConverters.IsNotNull}}"
                                            IsVisible="{Binding SelectedOka.IsUserData}"
                                            Background="{DynamicResource SuccessButtonBrush}" Foreground="{DynamicResource HeaderForegroundBrush}"
                                            Content="{Binding Edit, Source={x:Static loc:Strings.Instance}}" Padding="8,4"/>
                                    <!-- View button (default) for supplied items -->
                                    <Button Command="{Binding EditOkaCommand}"
                                            IsEnabled="{Binding SelectedOka, Converter={x:Static ObjectConverters.IsNotNull}}"
                                            IsVisible="{Binding !SelectedOka.IsUserData}"
                                            Content="{Binding View, Source={x:Static loc:Strings.Instance}}" Padding="8,4"/>
                                    <Button Content="{Binding New, Source={x:Static loc:Strings.Instance}}" Command="{Binding AddOkaCommand}"
                                            Background="{DynamicResource SuccessButtonBrush}" Foreground="{DynamicResource HeaderForegroundBrush}" Padding="8,4"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- OKA Distance -->
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="{Binding OkaDistance, Source={x:Static loc:Strings.Instance}}" VerticalAlignment="Center" FontWeight="SemiBold"/>
                                <NumericUpDown Value="{Binding OkaDistanceMeters}" ShowButtonSpinner="False"
                                               Minimum="0.1" Maximum="1000" Increment="0.5" Width="80"/>
                                <TextBlock Text="m" VerticalAlignment="Center"/>
                            </StackPanel>

                            <!-- OKA Building Damping -->
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="{Binding OkaDamping, Source={x:Static loc:Strings.Instance}}" VerticalAlignment="Center" FontWeight="SemiBold"/>
                                <NumericUpDown Value="{Binding OkaBuildingDampingDb}" ShowButtonSpinner="False"
                                               Minimum="0" Maximum="30" Increment="1" Width="80"/>
                                <TextBlock Text="dB" VerticalAlignment="Center"/>
                            </StackPanel>

                            <TextBlock Text="{Binding OkaExplanation, Source={x:Static loc:Strings.Instance}}"
                                       Opacity="0.6" FontSize="10" FontStyle="Italic" TextWrapping="Wrap"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Transmitter | Operating Parameters -->
                <Border Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}" CornerRadius="8" Padding="15">
                    <Grid ColumnDefinitions="1.3*,Auto,*">
                        <!-- Transmitter Section -->
                        <StackPanel Grid.Column="0" Spacing="6">
                            <TextBlock Text="{Binding Transmitter, Source={x:Static loc:Strings.Instance}}" FontWeight="Bold" FontSize="16"/>

                            <!-- Radio -->
                            <ComboBox ItemsSource="{Binding Radios}"
                                      SelectedItem="{Binding SelectedRadio}" HorizontalAlignment="Stretch"
                                      IsTextSearchEnabled="True"
                                      PlaceholderText="{Binding SelectRadio, Source={x:Static loc:Strings.Instance}}"/>
                            <StackPanel Orientation="Horizontal" Spacing="5">
                                <!-- Edit button (green) for user-created items -->
                                <Button Command="{Binding EditRadioCommand}"
                                        IsEnabled="{Binding SelectedRadio, Converter={x:Static ObjectConverters.IsNotNull}}"
                                        IsVisible="{Binding SelectedRadio.IsUserData}"
                                        Background="{DynamicResource SuccessButtonBrush}" Foreground="{DynamicResource HeaderForegroundBrush}"
                                        Content="{Binding Edit, Source={x:Static loc:Strings.Instance}}" Padding="8,4"/>
                                <!-- View button (default) for supplied items -->
                                <Button Command="{Binding EditRadioCommand}"
                                        IsEnabled="{Binding SelectedRadio, Converter={x:Static ObjectConverters.IsNotNull}}"
                                        IsVisible="{Binding !SelectedRadio.IsUserData}"
                                        Content="{Binding View, Source={x:Static loc:Strings.Instance}}" Padding="8,4"/>
                                <Button Content="{Binding New, Source={x:Static loc:Strings.Instance}}" Command="{Binding AddRadioCommand}"
                                        Background="{DynamicResource SuccessButtonBrush}" Foreground="{DynamicResource HeaderForegroundBrush}" Padding="8,4"/>
                            </StackPanel>

                            <!-- Linear (optional) -->
                            <CheckBox Content="{Binding UseLinearAmplifier, Source={x:Static loc:Strings.Instance}}" IsChecked="{Binding HasLinear}"/>
                            <StackPanel Spacing="8" IsVisible="{Binding HasLinear}">
                                <ComboBox ItemsSource="{Binding Radios}"
                                          SelectedItem="{Binding SelectedLinear}" HorizontalAlignment="Stretch"
                                          IsTextSearchEnabled="True"
                                          PlaceholderText="{Binding SelectLinear, Source={x:Static loc:Strings.Instance}}"/>
                                <StackPanel Orientation="Horizontal" Spacing="5">
                                    <Button Command="{Binding EditLinearCommand}"
                                            IsEnabled="{Binding SelectedLinear, Converter={x:Static ObjectConverters.IsNotNull}}"
                                            IsVisible="{Binding SelectedLinear.IsUserData}"
                                            Background="{DynamicResource SuccessButtonBrush}" Foreground="{DynamicResource HeaderForegroundBrush}"
                                            Content="{Binding Edit, Source={x:Static loc:Strings.Instance}}" Padding="8,4"/>
                                    <Button Command="{Binding EditLinearCommand}"
                                            IsEnabled="{Binding SelectedLinear, Converter={x:Static ObjectConverters.IsNotNull}}"
                                            IsVisible="{Binding !SelectedLinear.IsUserData}"
                                            Content="{Binding View, Source={x:Static loc:Strings.Instance}}" Padding="8,4"/>
                                    <Button Content="{Binding New, Source={x:Static loc:Strings.Instance}}" Command="{Binding AddLinearCommand}"
                                            Background="{DynamicResource SuccessButtonBrush}" Foreground="{DynamicResource HeaderForegroundBrush}" Padding="8,4"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Power -->
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="{Binding Power, Source={x:Static loc:Strings.Instance}}" VerticalAlignment="Center" FontWeight="SemiBold"/>
                                <NumericUpDown Value="{Binding PowerWatts}" ShowButtonSpinner="False"
                                               Minimum="1" Maximum="10000" Increment="10" Width="80"/>
                                <TextBlock Text="W" VerticalAlignment="Center"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Vertical Separator -->
                        <Border Grid.Column="1" Width="1" Background="{DynamicResource SystemControlForegroundBaseMediumBrush}" Margin="15,0" Opacity="0.3"/>

                        <!-- Operating Parameters Section -->
                        <StackPanel Grid.Column="2" Spacing="6">
                            <TextBlock Text="{Binding OperatingParameters, Source={x:Static loc:Strings.Instance}}" FontWeight="Bold" FontSize="16"/>

                            <!-- Modulation -->
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="{Binding Modulation, Source={x:Static loc:Strings.Instance}}" VerticalAlignment="Center" FontWeight="SemiBold"/>
                                <ComboBox ItemsSource="{Binding Modulations}"
                                          SelectedItem="{Binding SelectedModulation}"
                                          Width="160"/>
                            </StackPanel>

                            <!-- Activity Factor -->
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="{Binding ActivityFactor, Source={x:Static loc:Strings.Instance}}" VerticalAlignment="Center" FontWeight="SemiBold"/>
                                <NumericUpDown Value="{Binding ActivityFactor}" ShowButtonSpinner="False"
                                               Minimum="0" Maximum="1" Increment="0.1" Width="80"
                                               FormatString="0.0"/>
                            </StackPanel>

                            <TextBlock Text="{Binding ParametersApplyToAllBands, Source={x:Static loc:Strings.Instance}}"
                                       Opacity="0.6" FontSize="11" FontStyle="Italic" TextWrapping="Wrap"/>
                        </StackPanel>
                    </Grid>
                </Border>

            </StackPanel>
        </ScrollViewer>

        <!-- Buttons -->
        <Border Grid.Row="1" Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}" Padding="20,15">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <Button Content="{Binding Back, Source={x:Static loc:Strings.Instance}}" Command="{Binding CancelCommand}" Padding="20,10"/>
                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="6">
                    <Button Content="{Binding Cancel, Source={x:Static loc:Strings.Instance}}" Command="{Binding CancelCommand}" Padding="20,10"/>
                    <Button Content="{Binding Save, Source={x:Static loc:Strings.Instance}}" Command="{Binding SaveCommand}"
                            Background="{DynamicResource SuccessButtonBrush}" Foreground="{DynamicResource HeaderForegroundBrush}" Padding="20,10"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>

