<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:NIS.Desktop.ViewModels"
             xmlns:loc="using:NIS.Desktop.Localization"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="650" d:DesignHeight="550"
             x:Class="NIS.Desktop.Views.WelcomeView"
             x:DataType="vm:WelcomeViewModel">

    <Design.DataContext>
        <vm:WelcomeViewModel/>
    </Design.DataContext>

    <Grid RowDefinitions="*,Auto">
        <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <StackPanel Margin="40,30" Spacing="24" MaxWidth="900" HorizontalAlignment="Center">

            <!-- Projects in Database -->
            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                    BorderThickness="1" CornerRadius="8" Padding="15">
                <StackPanel Spacing="10">
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBlock Text="{Binding Projects, Source={x:Static loc:Strings.Instance}}"
                                   FontSize="18" FontWeight="Bold"/>
                        <Button Grid.Column="1"
                                Command="{Binding NewProjectCommand}"
                                Content="{Binding NewProject, Source={x:Static loc:Strings.Instance}}"
                                Background="{DynamicResource SuccessButtonBrush}"
                                Foreground="{DynamicResource HeaderForegroundBrush}"
                                Padding="15,8"/>
                    </Grid>

                    <!-- Search and sort -->
                    <Grid ColumnDefinitions="*,Auto,Auto" Margin="0,0,0,10">
                        <TextBox Text="{Binding SearchText}"
                                 Watermark="{Binding SearchProjects, Source={x:Static loc:Strings.Instance}}"
                                 Padding="10,8"/>
                        <Button Grid.Column="1"
                                Content="✕"
                                Command="{Binding ClearSearchCommand}"
                                IsVisible="{Binding SearchText, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                Margin="5,0,0,0"
                                Padding="8,6"
                                ToolTip.Tip="{Binding Clear, Source={x:Static loc:Strings.Instance}}"/>
                        <ComboBox Grid.Column="2"
                                  ItemsSource="{Binding SortOptions}"
                                  SelectedItem="{Binding SortOption}"
                                  Margin="10,0,0,0"
                                  MinWidth="180"/>
                    </Grid>

                    <!-- Project DataGrid -->
                    <DataGrid ItemsSource="{Binding FilteredProjects}"
                              IsVisible="{Binding HasFilteredProjects}"
                              AutoGenerateColumns="False"
                              CanUserReorderColumns="False"
                              CanUserResizeColumns="True"
                              CanUserSortColumns="True"
                              IsReadOnly="True"
                              SelectionMode="Single"
                              HeadersVisibility="Column"
                              GridLinesVisibility="All"
                              HorizontalGridLinesBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                              VerticalGridLinesBrush="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                              BorderBrush="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                              BorderThickness="1"
                              MaxHeight="400">
                        <DataGrid.Styles>
                            <Style Selector="DataGridColumnHeader">
                                <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundChromeMediumBrush}"/>
                                <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}"/>
                                <Setter Property="FontSize" Value="14"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                                <Setter Property="Padding" Value="12,8"/>
                                <Setter Property="MinHeight" Value="40"/>
                            </Style>
                        </DataGrid.Styles>
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="{Binding ProjectName, Source={x:Static loc:Strings.Instance}}"
                                                Binding="{Binding Name}" Width="*"/>
                            <DataGridTextColumn Header="{Binding Operator, Source={x:Static loc:Strings.Instance}}"
                                                Binding="{Binding Operator}" Width="Auto"/>
                            <DataGridTextColumn Header="{Binding Location, Source={x:Static loc:Strings.Instance}}"
                                                Binding="{Binding Location}" Width="Auto"/>
                            <DataGridTextColumn Header="{Binding Configurations, Source={x:Static loc:Strings.Instance}}"
                                                Binding="{Binding ConfigCount}" Width="Auto"/>
                            <DataGridTextColumn Header="{Binding Modified, Source={x:Static loc:Strings.Instance}}"
                                                Binding="{Binding ModifiedAt}" Width="Auto"/>
                            <DataGridTemplateColumn Header="{Binding Actions, Source={x:Static loc:Strings.Instance}}" Width="Auto">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center" Margin="5,0">
                                            <Button Content="{Binding Edit, Source={x:Static loc:Strings.Instance}}"
                                                    Command="{Binding $parent[DataGrid].((vm:WelcomeViewModel)DataContext).EditProjectFromListCommand}"
                                                    CommandParameter="{Binding}"
                                                    Padding="8,3"/>
                                            <Button Content="{Binding Delete, Source={x:Static loc:Strings.Instance}}"
                                                    Command="{Binding $parent[DataGrid].((vm:WelcomeViewModel)DataContext).DeleteProjectFromListCommand}"
                                                    CommandParameter="{Binding}"
                                                    Padding="8,3" Foreground="{DynamicResource DangerButtonBrush}"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- No search results state -->
                    <TextBlock Text="{Binding NoSearchResults, Source={x:Static loc:Strings.Instance}}"
                               IsVisible="{Binding ShowNoSearchResults}"
                               Opacity="0.5" FontStyle="Italic" Margin="10,5"/>

                    <!-- Empty state (no projects at all) -->
                    <TextBlock Text="{Binding NoProjects, Source={x:Static loc:Strings.Instance}}"
                               IsVisible="{Binding !HasProjectsInDatabase}"
                               Opacity="0.5" FontStyle="Italic" Margin="10,5"/>
                </StackPanel>
            </Border>

            <!-- Status Message -->
            <TextBlock Text="{Binding StatusMessage}"
                       FontSize="12" Opacity="0.8"
                       HorizontalAlignment="Center"
                       IsVisible="{Binding StatusMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>

            </StackPanel>
        </ScrollViewer>

        <!-- Footer -->
        <Border Grid.Row="1" Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}" Padding="20,12">
            <TextBlock Text="{Binding NisvCompliance, Source={x:Static loc:Strings.Instance}}"
                       FontSize="12" Opacity="0.5" HorizontalAlignment="Center"/>
        </Border>
    </Grid>
</UserControl>

